# Ударение-Анализатор Текста от команды "ОтрубИ"

![image](https://github.com/KirillStarodubovVR/CutEggOff/assets/89096305/f49c66dc-ffee-4c7a-b9fe-da2c1f259a08)

Разработка алгоритма контекстной расстановки ударений в текстах книг на русском языке и реализация пользовательского интерфейса в рамках учебного хакатона.

## Описание выбранного алгоритма
Этот проект разрабатывается с целью создания алгоритма, способного анализировать тексты книг и автоматически расставлять ударения в словах с учетом контекста. В качестве исходных данных алгоритм получает текст на русском языке и возвращает 3 файла: текст с ударениями, список омографов, список ненайденных в словаре слов (см. диаграмму ниже).

![image](https://github.com/KirillStarodubovVR/CutEggOff/assets/89096305/c7047f4c-0a89-4e1a-ad78-abbbed3c640a)

В основе словарей - полная акцентуированная парадигма по А. А. Зализняку, дополненная переработанным корпусом с [wiktionary](https://en.wiktionary.org/wiki/Wiktionary:Main_Page). С точки зрения пользователя Викисловарь представляет собой сайт, объединяющий сотни тысяч или миллионы страниц, связанных друг с другом гиперссылками. Словари, собранные с wiktionary доступны по [ссылке](https://kaikki.org/dictionary/Russian/index.html). 

| Словарь | Источник  | Обработанный словарь   |Формат|
| :---:   | :---: | :---: | :---: |
| Зализняк А.А.  и   Wiktionary. Словоформы| [www.speakrus.ru](https://web.archive.org/web/20200705182909/http://www.speakrus.ru/dict/)   [wiktionary_reworked](https://github.com/einhornus/russian_accentuation/blob/master/wordforms.dat)| [space](https://huggingface.co/spaces/Shakhovak/RU_accent_flask/resolve/main/dictionaries/file_norm.json?download=true)   |json. Пример: **"абажуром"**:{"accent":"абаж+уром","src_info":"['zaliznyak','russian_accentuation']"}|
| Зализняк А.А.    и    Wiktionary. Омографы| [www.speakrus.ru](https://web.archive.org/web/20200705182909/http://www.speakrus.ru/dict/)          [wiktionary_reworked](https://github.com/einhornus/russian_accentuation/blob/master/wordforms.dat) | [space](https://huggingface.co/spaces/Shakhovak/RU_accent_flask/resolve/main/dictionaries/file_omo.json?download=true)   |json. Пример: **"антициклонами"**:{"acc_variants":"[('+антицикл+онами', ['zaliznyak']), ('антицикл+онами', ['russian_accentuation'])]"}|

### Возможности
- Анализ контекста предложения.
- Сравнение слова с предоставленным словарем (словарной статьей).
- Расстановка ударений по тексту книги.
- Выделение многозначных случаев расстановки ударений.
- Выделение слов, для которых невозможно найти ударение в словарях.
- Возможность загрузки дополнительных словарей.

### Добавление нового словаря
Реализована возможность добавить собственный словарь омографов ```omograph_dictionary``` и ударений ```accent_dictionary```. Словари должны совпадать по формату данных (json), так и по содержанию, как в таблице выше.
```
ru_accent.load(custom_accent=accent_dictionary, custom_omographs=omograph_dictionary)
```
Добавленные словари доступны только во время запуска кода, основные словари в папках проекта не меняются. Для дополнения - необходимо переработать словарь и добавить/изменить в файлах json.

### Ограничения
- Алгоритм работает только с русским языком
- Возможность расстановки ударения ограничено размером словаря
- Не проведена ё-фикация словарей и алгоритма (если слово будет написано с буквой ё или е в разных контекстах, оно будет трактоваться по-разному)
- Алгоритм работает только с прописными буквами и не различит имени собсвенного и нарицательного, если они содержат одинаковые буквы.
- Словарь омографов, используемый в проекте, включает не только омографы как таковые, но и слова, имеющие разную ударную форму или разные ударения по версиям использованных словарей.
  
### Эксперименты с алгоритмом
Алгоритмы проверялись на тестовых данных (2 выборки по 5 тыс. текстов) - небольших текстах с ударениями, собранных с НКРЯ. В качестве метрики качества был выбрана **accuracy**, которая рассчитывалась как % exact match по словам без учета односложных слов и омографов.

Были проведены следующие эксперименты:
- :hammer_and_wrench: Использование объединенного словаря омографов и словоформ с отдельным словарем лемм; итеративный поиск ударения на основе выделенной леммы с помощью библиотеки spacy (код можно посмотреть [здесь](https://github.com/KirillStarodubovVR/CutEggOff/tree/anna_branch) в отдельной ветке данного репозитория). 
- :hammer_and_wrench: Использование отдельных словарей омографом и словоформ; прямой поиск слов в словарях.


| Алгоритм | Качество   | Комментарий    |
| :---:   | :---: | :---: |
| Объединенный словарь + словарь лемм с wiktionary| 66%   | С учетом омографов[^1]  Словарь - 600 тыс. словоформ.|
| Отдельные словари НКРЯ  | 94%   | Без учета омографов, есть риск bias так как выборка из тех же данных, что и словарь. Словарь - 3 млн. словоформ   |
| :star: Отдельные словари Зализняк А.А. + wiktionary  | 90%   | Без учета омографов. Словарь - 1,2 млн. словоформ   |
[^1]: Метрика не совсем сопоставима, так как считалась с учетом омографов в отличии от других экспериментов, но решили оставить, так как исходим из предположения, что только омографы не могут быть ответсвенны за низкое качество.

Был выбран последний алгоритм, так как он более академически выверен с точки зрения используемого словаря.Хотя словарь с НКРЯ содержит в 2 раза больше словоформ, в нем доволь Остальные методики не были использованы в основном коде.

## Варианты использования

### Использование в интерпретаторе 

Структура программы в репозитории выглядит следующим образом:

```bash
│   README.md
│   ruaccent.py - основной файл алгоритма
│   text_split.py - разбивка на слова
|
├───web_interface - оформление веб-интерфейса
│       web_interface.py - для запуска UI c flask
│       pc_app.py - для запуска UI c customtkinter
|
├───templates - оформление веб-интерфейса
│       index.html
|       result.html
|
├───dictionaries
│       .gitattributes
│       accents.json - словарь словоформ
│       omographs.json - словарь омографов
│   
├───test_data
│       test_1_5000.csv - тестовая выборка на основе НКРЯ
│       test_2_5000.csv - тестовая выборка на основе НКРЯ
|       metrics_review.ipynb - блокнот с расчетом метрики
```
Для корректной работы словари ([словоформы](https://huggingface.co/spaces/Shakhovak/RU_accent_flask/resolve/main/dictionaries/file_norm.json?download=true),[омографы](https://huggingface.co/spaces/Shakhovak/RU_accent_flask/resolve/main/dictionaries/file_omo.json?download=true)) нужно скачать с указанных ссылок в папку dictionaries.

Для начала работы нужно:
- клонировать репозиторий
- скачать словари и добавить их в папку ```dictionaries```
- создать объект класс RUAccent и загрузить в него словари 
```
ru_accent = RUAccent()
ru_accent.load()
```
Всё что дальше требуется это загрузить текст в ```ru_accent.process_all(text=your_text)```
И программа вернёт 3 списка. Список из предложений текста с расставленными ударениями, список с омографами и список с неизвестными словами.
```
text_to_process = "В этом замке совершенно нет ни одного замка. Наверно я не буду ругаться с нига из-за этого сучонка"
processed_text = ru_accent.process_all(text_to_process)
print(processed_text)
```
### Развертывание на базе gradio
Используется интерфейс gradio на платформе hugging face. Можно ввести предложения для расстановки ударения и на экране сразу отобразятся обработанный текст, списки омогрофов и неизвестных слов. Попробовать версию интерфейса можно [здесь.](https://huggingface.co/spaces/Shakhovak/RU_ACCENT)

![image](https://github.com/KirillStarodubovVR/CutEggOff/assets/89096305/403fc4cd-b46c-4f60-9f37-65319ff9966a)

> [!IMPORTANT]
> Веб интерфейс доступен 48 часов с момента последнего использования. Дальше он отключается и требует повторного запуска.

### Развертывание на базе flask
Используется интерфейс flask на платформе hugging face. Можно ввести предложения для расстановки ударения или загрузить файл, программа подготовит три файла, доступные для загрузки: обработанный текст, списки омографов и неизвестных слов. Попробовать версию интерфейса можно [здесь.](https://huggingface.co/spaces/Shakhovak/RU_accent_flask)

![image](https://github.com/KirillStarodubovVR/CutEggOff/assets/89096305/6dc42b7f-a0c6-4184-864d-2c24fcaa4e8c)

![image](https://github.com/KirillStarodubovVR/CutEggOff/assets/89096305/4e551771-9056-47a7-be83-6576a6f32ce8)

> [!IMPORTANT]
> Веб интерфейс доступен 48 часов с момента последнего использования. Дальше он отключается и требует повторного запуска.

### Использование телеграм-бота
В качестве одного из первых вариантов был использован чат-бот @ru_stress_bot для обработки текста по итеративному принципу.

![image](https://github.com/KirillStarodubovVR/CutEggOff/assets/89096305/cfb3f418-dc8b-4223-8599-3f51fdb325dc)

> [!WARNING]
> В основе чат-бота не финальный алгоритм! Чат-бот запущен на платном сервисе и после окончания хакатона будет отключен!

## Дальнейшее развитие проекта
- Можно сделать подсвечивание омографов и неизвестных слов. Добавление в список не только слов, но и контекста.
- Добавить синтез речи и работу со словами с латинискими буквами.
- Классифицировать неизвестные слова имена собственные, топонимы и т.д.
- Добавить возможность вносить отдельные слова в словари, а не только готовый словарь
- Добавить нейронную сеть, которая будет предлагать варианты ударения для неизвестных слов
- Доработать интерфейс: сделать возможность исправления словарей через интерфейс, для редких слов выводить из книг примеры использования и т.д.
 
## Вклад в проект

При создании алгоритма команда вдохновлялась решениями:

- :pencil: https://github.com/einhornus/russian_accentuation/
- :pencil: https://github.com/Den4ikAI/ruaccent


## Команда
:stuck_out_tongue_winking_eye:
- Кирилл Стародубов, Анна Зверева - код анализатора текста
- Александр Левакин, Андрей Илюхин, Екатерина Шахова, Дмитрий Петров - работа со словарями и веб-интерфейсами
